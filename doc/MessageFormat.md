# Формат сообщений RAO
---
### Общие:
#### Формат сообщения от клиента к серверу:
```javascript
{
    "type": msg_type, // Возможные варианты сообщений описаны ниже, отдельно для клиента и сервера
    "api": api_version, // Всегда необходимо указывать версию интерфейса
    "data": {} // Все данные запросы помещаются сюда, формат зависит от версии api
}
```

#### Формат сообщения от сервера к клиенту:
```javascript
{
    "type": msg_type, // Возможные варианты сообщений описаны ниже, отдельно для клиента и сервера
    "code": msg_code, // Расшифровка кодов описана ниже
    "error": "сообщение", // Присутствует только в случае ошибки
    "data": {} // Все данные запросы помещаются сюда, формат зависит от версии api
}
```
---
### От сервера:
Возможные msg_type:
-  *information* - игровая информация (карта, игроки, враги, чат)
-  *status* - информация по игроку
-  *response* - ответ на некоторые запросы клиента
 
---
### От клиента:
Возможные msg_type:
- *connect* - подключение к серверу
```javascript
data: {
    "login": "ваш логин",
    "password": "ваш пароль"  // временно без хеша
}
```
- *connect_room* - подключение к игровой комнате
```javascript
data: {
    "index": "номер комнаты"
}
```
- *disconnect* - отключение от сервера или от комнаты, если находитесь в игре
- *control* - команды для управления героем во время игры
```javascript
data: {
    "action": control_[up|down|left|right] | action
}
```
- *request* - запрос на получения информации
```javascript
data: {
    "requests": [список запросов игры] // Возможные варианты запросов описаны ниже
}
```
- *status* - запрос статуса игрока (играет ли сейчас, краткое описание героя)
```javascript
data: {
    "requests": [список запросов статуса] // Возможные варианты запросов описаны ниже
}
```
- *chat* - отправка сообщения в комнату или лобби
```javascript
data: {
    "message": сообщение
}
```
---
### Запросы информации статуса:
- roomlist - список всех комнат и краткая информация о них
- player - информация об вашем профиле и герое

### Запросы информации игры:
- players - информация об всех игроках в комнате
- map - информация о карте в комнате

### Коды сообщений (msg_code):
- 200 successful - успешно
- 403 forbidden - запрещено
- 1 api.incorrect_version - не указана версия метода
- 2 json.incorrect_format - неверный формат данных для типа сообщения: msg_type
- 3 json.incorrect_data - неверные значения данных для типа сообщения: msg_type
- 4 auth.incorrect_login_or_password - неверные логин или пароль
- 5 auth.already_logged - попытка повторной авторизации
- 6 auth.not_logged_in - не авторизован для этого действия
- 10 player.not_in_game - игрок должен быть в игре
- 11 player.not_in_lobby - игрок должен быть в лобби
- 20 game.room.max_players - в комнате максимальное количество игроков

